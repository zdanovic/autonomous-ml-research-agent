"""
Pydantic Schemas for the Agentic System.
"""
from datetime import datetime
from enum import Enum
from typing import Any

from pydantic import BaseModel, Field


class ExperimentStatus(str, Enum):
    PLANNED = "planned"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"

class HypothesisPriority(str, Enum):
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"

class Hypothesis(BaseModel):
    """
    A scientific hypothesis generated by the DataScientist.
    """
    id: str
    statement: str
    rationale: str
    experiment_design: str
    expected_improvement: float
    priority: HypothesisPriority = HypothesisPriority.MEDIUM
    status: str = "untested"
    tags: list[str] = []

class ExperimentSpec(BaseModel):
    """
    A specific, executable experiment design.
    """
    id: str
    hypothesis_id: str
    name: str
    description: str
    strategy: str  # e.g., "catboost_grouped", "stacking"
    params: dict[str, Any] = {}
    validation_strategy: str = "kfold"
    n_folds: int = 5
    status: ExperimentStatus = ExperimentStatus.PLANNED
    created_at: datetime = Field(default_factory=datetime.now)

class ExperimentResult(BaseModel):
    """
    The outcome of an experiment execution.
    """
    experiment_id: str
    cv_score: float
    public_score: float | None = None
    submission_path: str | None = None
    metrics: dict[str, float] = {}
    artifacts: dict[str, str] = {}  # paths to models, plots
    duration_seconds: float
    success: bool
    error_message: str | None = None
    timestamp: datetime = Field(default_factory=datetime.now)

class LeaderboardEntry(BaseModel):
    """
    Entry in the internal leaderboard.
    """
    experiment_id: str
    cv_score: float
    timestamp: datetime
